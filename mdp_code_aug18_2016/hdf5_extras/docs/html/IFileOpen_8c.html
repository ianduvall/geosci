<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>HDF5 Extras: src/IFileOpen.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">HDF5 Extras
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Convenience Functions for using HDF5 Better</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">IFileOpen.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="ifile_8h_source.html">ifile.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab515cce6f7ef898d5b8299651ae2c4dd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab515cce6f7ef898d5b8299651ae2c4dd"></a>
<a class="el" href="structIFILE.html">IFILE</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>ifileopen_setup_read</b> (hid_t ifile_id, const char *ifilename, int access)</td></tr>
<tr class="separator:ab515cce6f7ef898d5b8299651ae2c4dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71f1750039e2191e0717a4e83cee10d6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a71f1750039e2191e0717a4e83cee10d6"></a>
<a class="el" href="structIFILE.html">IFILE</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>ifileopen_setup_write</b> (hid_t ifile_id, const char *ifilename, int access)</td></tr>
<tr class="separator:a71f1750039e2191e0717a4e83cee10d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16a967c210fe32021df5d451452c9170"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a16a967c210fe32021df5d451452c9170"></a>
<a class="el" href="structIFILE.html">IFILE</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>ifileopen_setup_append</b> (hid_t ifile_id, const char *ifilename, int access)</td></tr>
<tr class="separator:a16a967c210fe32021df5d451452c9170"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78506f989a0e0ef1114b0f1e3537112e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a78506f989a0e0ef1114b0f1e3537112e"></a>
<a class="el" href="structIFILE.html">IFILE</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>IFileCreate</b> (hid_t ifile_id, const char *ifilename)</td></tr>
<tr class="separator:a78506f989a0e0ef1114b0f1e3537112e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a659760c048381d534347487e14cd5e25"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structIFILE.html">IFILE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="IFileOpen_8c.html#a659760c048381d534347487e14cd5e25">IFileOpen</a> (hid_t file_id, const char *ifilename, const char *access)</td></tr>
<tr class="memdesc:a659760c048381d534347487e14cd5e25"><td class="mdescLeft">&#160;</td><td class="mdescRight">IFileOpen is used to open an internal file in a GEOSCI Database File.  <a href="#a659760c048381d534347487e14cd5e25">More...</a><br /></td></tr>
<tr class="separator:a659760c048381d534347487e14cd5e25"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a659760c048381d534347487e14cd5e25"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structIFILE.html">IFILE</a>* IFileOpen </td>
          <td>(</td>
          <td class="paramtype">hid_t&#160;</td>
          <td class="paramname"><em>file_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ifilename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>access</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>IFileOpen is used to open an internal file in a GEOSCI Database File. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">file_id</td><td>The handle of the open GeoSciPy file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ifilename</td><td>The name of the internal file in an existing GEOSCI database to be opened. Use Unix filenaming conventions, giving the full pathname, starting with "/". All but the last component of this name must already exist. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">access</td><td>Access mode for the IFile, similar to that used for files: <br />
 <ul>
<li>"r" read: Open internal file for input operations. Must already exist.</li>
<li>"w" write: Create an empty file for output operations. If an internal file with the same name already exists, its contents are discarded and the file is treated as a new empty internal file.</li>
<li>"a" append: Open internal file for output at the end of a the file. Output operations always write data at the end of the file, expanding it. Repositioning operations (IFileSeek, IFileSetpos, IFileRewind) are silently ignored. The internal file is created if it does not exist.</li>
<li>"r+" read/update: Open an internal file for update (both for input and output). The file must already exist.</li>
<li>"w+" write/update: Create an empty internal file and open it for update (both for input and output). If an internal file with the same name already exists its contents are discarded and the internal file is treated as a new empty file.</li>
<li>"a+" append/update: Open an internal file for update (both for input and output) with all output operations writing data at the end of the file. Repositioning operations (IFileSeek, IFileSetpos, IFileRewind) affect the next input operations, but output operations move the position back to the end of internal file. The internal file is created if it does not exist.</li>
</ul>
<p class="endtd">The letter "x" can be appended to any "w" specifier (to form "wx" or "w+x"). This subspecifier forces the function to fail if the internal file exists, instead of overwriting it. <br />
 Sometimes a "b" is appended to indicate binary mode for reading and writing, but that is not necessary, so it is ignored. </p>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>If the internal file is successfully opened, the function returns a pointer to a structure, otherwise a NULL pointer is returned.</dd></dl>
<dl class="section user"><dt>Example 1</dt><dd>Let's assume that one already has an GeoSci file, and one wants to add an internal file, named "somename", off of the root: <div class="fragment"><div class="line">hid_t file_id;</div>
<div class="line"><a class="code" href="structIFILE.html">IFILE</a> *ifilep;</div>
<div class="line"></div>
<div class="line">ifilep = <a class="code" href="ifile_8h.html#a659760c048381d534347487e14cd5e25">IFileOpen</a>(file_id,<span class="stringliteral">&quot;/somename&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span>(!ifilep) {</div>
<div class="line">   printf(<span class="stringliteral">&quot;IFileOpen failed on /somename\n&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Example 2</dt><dd>Let's assume that one already has an GeoSci file, and one wants to add an internal file inside another group: <div class="fragment"><div class="line">hid_t file_id, group_id;</div>
<div class="line"><a class="code" href="structIFILE.html">IFILE</a> *ifilep;</div>
<div class="line"><a class="code" href="structtagbstring.html">bstring</a> name=bfromcstr(<span class="stringliteral">&quot;/group1&quot;</span>);</div>
<div class="line">group_id = <a class="code" href="GS__GroupCreate_8c.html#a30baf67ef893fad57fe691473bc26b33">GS_GroupCreate</a>(file_id,name);</div>
<div class="line">bdestroy(name);</div>
<div class="line"><span class="keywordflow">if</span>(group_id &lt; 0) {</div>
<div class="line">   printf(<span class="stringliteral">&quot;GroupCreate failed on /group1\n&quot;</span>);</div>
<div class="line">   exit(-1);</div>
<div class="line">}</div>
<div class="line">ifilep = <a class="code" href="ifile_8h.html#a659760c048381d534347487e14cd5e25">IFileOpen</a>(file_id,<span class="stringliteral">&quot;/group1/somename&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span>(!ifilep) {</div>
<div class="line">   printf(<span class="stringliteral">&quot;IFileOpen failed on /group1/somename\n&quot;</span>);</div>
<div class="line">   exit(-1);</div>
<div class="line">}</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Details</dt><dd><p class="startdd">This function is meant to emulate as close as possible the standard C fopen() function.</p>
<p>For internal files open for update (those which include a "+" sign), on which both input and output operations are allowed, the file should be flushed (IFileFlush) or repositioned (IFileSeek, IFileSetpos, IFileRewind) between either a writing operation followed by a reading operation or a reading operation which did not reach the end-of-file followed by a writing operation.</p>
<p>When appropriate, this routine creates a single-dimensional unsigned-8-bit dataset with the given name. The components of the pathname above the filename must already exist, and be HDF5 groups in order for this to work.</p>
<p class="enddd">Note that even if you intend to only read from an IFile, you need to open the GeoSciPy file for reading AND writing ("r+"). This is because the state of the internal file is written to metadata in the GeoSciPy file, even if one is only reading from the IFile. </p>
</dd></dl>
<dl class="section user"><dt>Implementation</dt><dd><p class="startdd">For developers, the details of the implementation are presented here.</p>
<p>The complete list of all 34 IFile-related functions is given below:</p>
<ul>
<li><a class="el" href="GS__ObjectIsIFile_8c.html">GS_ObjectIsIFile.c</a> (also contains ObjectIsIFileByID)</li>
<li>GS_ObjectIsMetadataIFile.c</li>
<li>DatasetGetType.c</li>
<li>DatasetSetType.c</li>
<li><a class="el" href="IFileAllocate_8c.html">IFileAllocate.c</a></li>
<li><a class="el" href="IFileClearError_8c.html">IFileClearError.c</a></li>
<li>IFileClose.c</li>
<li>IFileEOF.c</li>
<li>IFileError.c</li>
<li>IFileFlush.c</li>
<li>IFileGetc.c</li>
<li>IFileGets.c</li>
<li>IFileGetWrite.c</li>
<li><a class="el" href="IFileOpen_8c.html">IFileOpen.c</a></li>
<li>IFilePerror.c</li>
<li>IFilePrintf.c</li>
<li>IFilePutc.c</li>
<li>IFilePuts.c</li>
<li>IFileReadAccess.c</li>
<li>IFileRead.c</li>
<li>IFileReadStatus.c</li>
<li>IFileRewind.c</li>
<li>IFileScanf.c</li>
<li>IFileSeek.c</li>
<li>IFileSetEOF.c</li>
<li>IFileSetWriteability.c</li>
<li>IFileSetWrite.c</li>
<li>IFileSize.c</li>
<li>IFileTell.c</li>
<li>IFileTruncate.c</li>
<li>IFileWriteAccess.c</li>
<li>IFileWrite.c</li>
<li>IFileWriteStatus.c</li>
<li>IFileWriteStatusMessage.c</li>
</ul>
<p>Some of these are named based on the standard C library functions that they emulate. Others are implementation-specific functions.</p>
<p>The overall idea of a IFile is that of a HDF5 dataset. This dataset is 1-dimensional, with a datatype of unsigned-8-bit. It is infinitely extendable. It has three string attributes:</p>
<ul>
<li>writeable: "TRUE" or "FALSE". The user can set this so that don't accidentally over-write it or delete it. All IFiles are created with writeable="TRUE"</li>
<li>access: an integer betwen 0 and 6, converted to a string. Corresponds to one of the following #define'd parameters: <ul>
<li>IFILE_CLOSED 0 </li>
<li>IFILE_R 1 </li>
<li>IFILE_W 2 </li>
<li>IFILE_A 3 </li>
<li>IFILE_RP 4 </li>
<li>IFILE_WP 5 </li>
<li>IFILE_AP 6</li>
</ul>
These are named based on the access string used during the <a class="el" href="IFileOpen_8c.html#a659760c048381d534347487e14cd5e25" title="IFileOpen is used to open an internal file in a GEOSCI Database File. ">IFileOpen()</a> function-call, the "P" meaning "+". This keeps track of how the file was opened so only appropriate operations are allowed. Note that a file that is open cannot be opened by another command: the file must be CLOSED in order to be opened. This implements a very simple locking mechanism</li>
<li>dataset_type: for an IFile this must be "1", which corresponds to the C #define GS_DATASET_TYPE_INTERNAL_FILE This is needed because image rasters are stored as datasets as well, and we need to distinguish between these.</li>
</ul>
<p>The returned data structure is defined as: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">  hid_t ifile_id;</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">int</span> file_position;</div>
<div class="line">  <span class="keywordtype">int</span> readPastEOF;</div>
<div class="line">  <span class="keywordtype">int</span> last_operation_status;</div>
<div class="line">  <span class="keywordtype">char</span> last_operation_status_message[512];</div>
<div class="line">  <span class="keywordtype">int</span> access;</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">int</span> size;</div>
<div class="line">} <a class="code" href="structIFILE.html">IFILE</a>;</div>
</div><!-- fragment --><p class="enddd"></p>
</dd></dl>
<dl class="section user"><dt></dt><dd>The parameters in this structure are defined as follows:</dd></dl>
<ul>
<li><em>ifile_id</em>: the HDF5 object-id for this dataset.</li>
<li><em>file_position</em>: This is the next byte to read-from or write-to, where file_position=0 means to read/write the first byte in the file.</li>
<li><em>readPastEOF</em>: "TRUE"=1 or "FALSE"=0. Whether the previous operation tried to read past the last byte in the file.</li>
<li><em>last_operation_status</em>: "SUCCESS"=1 or "FAILURE"=0 Each operation on the IFile sets this.</li>
<li><em>last_operation_status_message</em>: a string written by each of the IFile functions, whether they succeed or fail.</li>
<li><em>access</em>: A copy of the dataset-metadata entry.</li>
<li><em>size</em>: The current file size in bytes. This is obtained when opened using HDF5 function calls. Thereafter it is updated by the the functions as needed.</li>
</ul>
<dl class="section user"><dt></dt><dd>Functions that deal with these metadata items are given below. Generally the user should never call any of these, except for:<ul>
<li>IFileSetWriteability() for setting the writeability of an IFile when it is closed.</li>
<li>IFileError() for determining error status</li>
<li>IFilePerror() for printing the latest error</li>
<li>IFileEOF() for determining the EOF status of last read</li>
<li>IFileSeek() for moving the file position</li>
<li>IFileTell() for determining the file position</li>
<li>IFileRewind() for setting the file position to 0</li>
</ul>
</dd></dl>
<ul>
<li>GS_ObjectIsIFile &ndash; must be a dataset with dataset_type="1"</li>
<li>GS_DatasetGetType&ndash; returns the dataset_type</li>
<li>GS_DatasetSetType&ndash; sets the dataset_type</li>
<li>IFileClearError &ndash; sets last_operation_status="SUCCESS" and sets last_operation_status_message</li>
<li>IFileError &ndash; returns TRUE if last_operation_status="FAILURE"</li>
<li>IFilePerror &ndash; prints last_operation_status_message</li>
<li>IFileReadStatus &ndash; reads last_operation_status, and last_operation_status_message</li>
<li>IFileWriteStatus &ndash; writes last_operation_status, and last_operation_status_message</li>
<li>IFileWriteStatusMessage &ndash; writes last_operation_status_message</li>
<li>IFileEOF &ndash; returns TRUE if readPastEOF="TRUE"</li>
<li>IFileSetEOF &ndash; writes to readPastEOF</li>
<li>IFileGetWrite &ndash; returns TRUE If writeable="TRUE"</li>
<li>IFileSetWrite &ndash; sets writeability (developer function)</li>
<li>IFileSetWriteability &ndash; sets writeability (user function)</li>
<li>IFileReadAccess &ndash; reads access</li>
<li>IFileWriteAccess &ndash; writes access</li>
<li>IFileSeek &ndash; sets file_position</li>
<li>IFileTell &ndash; reads file_position</li>
<li>IFileRewind &ndash; sets file_position to "0"</li>
</ul>
<dl class="section user"><dt></dt><dd>Functions to deal with the file size directly:</dd></dl>
<ul>
<li>IFileTruncate &ndash; sets size of file (can shrink or grow)</li>
<li>IFileAllocate &ndash; expands file size if needed</li>
<li>IFileSize &ndash; gets the current file size from the struct</li>
<li>IFileSizeHDF &ndash; gets the current file size from HDF</li>
</ul>
<dl class="section user"><dt></dt><dd>Other functions that the user can use include:</dd></dl>
<ul>
<li>IFileOpen &ndash; open an IFile</li>
<li>IFileClose &ndash; close an IFile</li>
<li>IFileFlush &ndash; flush any changes to the IFile to disk</li>
<li>IFileGetc &ndash; read a single character</li>
<li>IFileGets &ndash; read a newline-terminated string</li>
<li>IFileRead &ndash; read a set number of bytes</li>
<li>IFileScanf &ndash; formatted-read from next "line"</li>
<li>IFilePutc &ndash; write a single character</li>
<li>IFilePuts &ndash; write a newline-terminated string</li>
<li>IFileWrite &ndash; write a set number of bytes</li>
<li>IFilePrintf &ndash; write a formatted string</li>
</ul>
<dl class="section user"><dt></dt><dd>Note that there is only ONE COPY of the file state, so there can only be one process that is using it at one time. This is on purpose so that there are no parallel-read-write issues. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 1 2016 19:34:06 for HDF5 Extras by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
