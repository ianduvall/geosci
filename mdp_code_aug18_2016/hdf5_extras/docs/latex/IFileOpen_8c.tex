\hypertarget{IFileOpen_8c}{\section{src/\+I\+File\+Open.c File Reference}
\label{IFileOpen_8c}\index{src/\+I\+File\+Open.\+c@{src/\+I\+File\+Open.\+c}}
}
{\ttfamily \#include \char`\"{}ifile.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{IFileOpen_8c_ab515cce6f7ef898d5b8299651ae2c4dd}{\hyperlink{structIFILE}{I\+F\+I\+L\+E} $\ast$ {\bfseries ifileopen\+\_\+setup\+\_\+read} (hid\+\_\+t ifile\+\_\+id, const char $\ast$ifilename, int access)}\label{IFileOpen_8c_ab515cce6f7ef898d5b8299651ae2c4dd}

\item 
\hypertarget{IFileOpen_8c_a71f1750039e2191e0717a4e83cee10d6}{\hyperlink{structIFILE}{I\+F\+I\+L\+E} $\ast$ {\bfseries ifileopen\+\_\+setup\+\_\+write} (hid\+\_\+t ifile\+\_\+id, const char $\ast$ifilename, int access)}\label{IFileOpen_8c_a71f1750039e2191e0717a4e83cee10d6}

\item 
\hypertarget{IFileOpen_8c_a16a967c210fe32021df5d451452c9170}{\hyperlink{structIFILE}{I\+F\+I\+L\+E} $\ast$ {\bfseries ifileopen\+\_\+setup\+\_\+append} (hid\+\_\+t ifile\+\_\+id, const char $\ast$ifilename, int access)}\label{IFileOpen_8c_a16a967c210fe32021df5d451452c9170}

\item 
\hypertarget{IFileOpen_8c_a78506f989a0e0ef1114b0f1e3537112e}{\hyperlink{structIFILE}{I\+F\+I\+L\+E} $\ast$ {\bfseries I\+File\+Create} (hid\+\_\+t ifile\+\_\+id, const char $\ast$ifilename)}\label{IFileOpen_8c_a78506f989a0e0ef1114b0f1e3537112e}

\item 
\hyperlink{structIFILE}{I\+F\+I\+L\+E} $\ast$ \hyperlink{IFileOpen_8c_a659760c048381d534347487e14cd5e25}{I\+File\+Open} (hid\+\_\+t file\+\_\+id, const char $\ast$ifilename, const char $\ast$access)
\begin{DoxyCompactList}\small\item\em I\+File\+Open is used to open an internal file in a G\+E\+O\+S\+C\+I Database File. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{IFileOpen_8c_a659760c048381d534347487e14cd5e25}{\index{I\+File\+Open.\+c@{I\+File\+Open.\+c}!I\+File\+Open@{I\+File\+Open}}
\index{I\+File\+Open@{I\+File\+Open}!I\+File\+Open.\+c@{I\+File\+Open.\+c}}
\subsubsection[{I\+File\+Open}]{\setlength{\rightskip}{0pt plus 5cm}{\bf I\+F\+I\+L\+E}$\ast$ I\+File\+Open (
\begin{DoxyParamCaption}
\item[{hid\+\_\+t}]{file\+\_\+id, }
\item[{const char $\ast$}]{ifilename, }
\item[{const char $\ast$}]{access}
\end{DoxyParamCaption}
)}}\label{IFileOpen_8c_a659760c048381d534347487e14cd5e25}


I\+File\+Open is used to open an internal file in a G\+E\+O\+S\+C\+I Database File. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em file\+\_\+id} & The handle of the open Geo\+Sci\+Py file. \\
\hline
\mbox{\tt in}  & {\em ifilename} & The name of the internal file in an existing G\+E\+O\+S\+C\+I database to be opened. Use Unix filenaming conventions, giving the full pathname, starting with \char`\"{}/\char`\"{}. All but the last component of this name must already exist. \\
\hline
\mbox{\tt in}  & {\em access} & Access mode for the I\+File, similar to that used for files\+: ~\newline
 
\begin{DoxyItemize}
\item \char`\"{}r\char`\"{} read\+: Open internal file for input operations. Must already exist.
\item \char`\"{}w\char`\"{} write\+: Create an empty file for output operations. If an internal file with the same name already exists, its contents are discarded and the file is treated as a new empty internal file.
\item \char`\"{}a\char`\"{} append\+: Open internal file for output at the end of a the file. Output operations always write data at the end of the file, expanding it. Repositioning operations (I\+File\+Seek, I\+File\+Setpos, I\+File\+Rewind) are silently ignored. The internal file is created if it does not exist.
\item \char`\"{}r+\char`\"{} read/update\+: Open an internal file for update (both for input and output). The file must already exist.
\item \char`\"{}w+\char`\"{} write/update\+: Create an empty internal file and open it for update (both for input and output). If an internal file with the same name already exists its contents are discarded and the internal file is treated as a new empty file.
\item \char`\"{}a+\char`\"{} append/update\+: Open an internal file for update (both for input and output) with all output operations writing data at the end of the file. Repositioning operations (I\+File\+Seek, I\+File\+Setpos, I\+File\+Rewind) affect the next input operations, but output operations move the position back to the end of internal file. The internal file is created if it does not exist.
\end{DoxyItemize}

The letter \char`\"{}x\char`\"{} can be appended to any \char`\"{}w\char`\"{} specifier (to form \char`\"{}wx\char`\"{} or \char`\"{}w+x\char`\"{}). This subspecifier forces the function to fail if the internal file exists, instead of overwriting it. ~\newline
 Sometimes a \char`\"{}b\char`\"{} is appended to indicate binary mode for reading and writing, but that is not necessary, so it is ignored. \\
\hline
\end{DoxyParams}


\begin{DoxyReturn}{Returns}
If the internal file is successfully opened, the function returns a pointer to a structure, otherwise a N\+U\+L\+L pointer is returned.
\end{DoxyReturn}
\begin{DoxyParagraph}{Example 1}
Let's assume that one already has an Geo\+Sci file, and one wants to add an internal file, named \char`\"{}somename\char`\"{}, off of the root\+: 
\begin{DoxyCode}
hid\_t file\_id;
\hyperlink{structIFILE}{IFILE} *ifilep;

ifilep = \hyperlink{ifile_8h_a659760c048381d534347487e14cd5e25}{IFileOpen}(file\_id,\textcolor{stringliteral}{"/somename"},\textcolor{stringliteral}{"w"});
\textcolor{keywordflow}{if}(!ifilep) \{
   printf(\textcolor{stringliteral}{"IFileOpen failed on /somename\(\backslash\)n"});
\}
\end{DoxyCode}

\end{DoxyParagraph}
\begin{DoxyParagraph}{Example 2}
Let's assume that one already has an Geo\+Sci file, and one wants to add an internal file inside another group\+: 
\begin{DoxyCode}
hid\_t file\_id, group\_id;
\hyperlink{structIFILE}{IFILE} *ifilep;
\hyperlink{structtagbstring}{bstring} name=bfromcstr(\textcolor{stringliteral}{"/group1"});
group\_id = \hyperlink{GS__GroupCreate_8c_a30baf67ef893fad57fe691473bc26b33}{GS\_GroupCreate}(file\_id,name);
bdestroy(name);
\textcolor{keywordflow}{if}(group\_id < 0) \{
   printf(\textcolor{stringliteral}{"GroupCreate failed on /group1\(\backslash\)n"});
   exit(-1);
\}
ifilep = \hyperlink{ifile_8h_a659760c048381d534347487e14cd5e25}{IFileOpen}(file\_id,\textcolor{stringliteral}{"/group1/somename"},\textcolor{stringliteral}{"w"});
\textcolor{keywordflow}{if}(!ifilep) \{
   printf(\textcolor{stringliteral}{"IFileOpen failed on /group1/somename\(\backslash\)n"});
   exit(-1);
\}
\end{DoxyCode}

\end{DoxyParagraph}
\begin{DoxyParagraph}{Details}
This function is meant to emulate as close as possible the standard C fopen() function.

For internal files open for update (those which include a \char`\"{}+\char`\"{} sign), on which both input and output operations are allowed, the file should be flushed (I\+File\+Flush) or repositioned (I\+File\+Seek, I\+File\+Setpos, I\+File\+Rewind) between either a writing operation followed by a reading operation or a reading operation which did not reach the end-\/of-\/file followed by a writing operation.

When appropriate, this routine creates a single-\/dimensional unsigned-\/8-\/bit dataset with the given name. The components of the pathname above the filename must already exist, and be H\+D\+F5 groups in order for this to work.

Note that even if you intend to only read from an I\+File, you need to open the Geo\+Sci\+Py file for reading A\+N\+D writing (\char`\"{}r+\char`\"{}). This is because the state of the internal file is written to metadata in the Geo\+Sci\+Py file, even if one is only reading from the I\+File. 
\end{DoxyParagraph}


\begin{DoxyParagraph}{Implementation}
For developers, the details of the implementation are presented here.

The complete list of all 34 I\+File-\/related functions is given below\+:


\begin{DoxyItemize}
\item \hyperlink{GS__ObjectIsIFile_8c}{G\+S\+\_\+\+Object\+Is\+I\+File.\+c} (also contains Object\+Is\+I\+File\+By\+I\+D)
\item G\+S\+\_\+\+Object\+Is\+Metadata\+I\+File.\+c
\item Dataset\+Get\+Type.\+c
\item Dataset\+Set\+Type.\+c
\item \hyperlink{IFileAllocate_8c}{I\+File\+Allocate.\+c}
\item \hyperlink{IFileClearError_8c}{I\+File\+Clear\+Error.\+c}
\item I\+File\+Close.\+c
\item I\+File\+E\+O\+F.\+c
\item I\+File\+Error.\+c
\item I\+File\+Flush.\+c
\item I\+File\+Getc.\+c
\item I\+File\+Gets.\+c
\item I\+File\+Get\+Write.\+c
\item \hyperlink{IFileOpen_8c}{I\+File\+Open.\+c}
\item I\+File\+Perror.\+c
\item I\+File\+Printf.\+c
\item I\+File\+Putc.\+c
\item I\+File\+Puts.\+c
\item I\+File\+Read\+Access.\+c
\item I\+File\+Read.\+c
\item I\+File\+Read\+Status.\+c
\item I\+File\+Rewind.\+c
\item I\+File\+Scanf.\+c
\item I\+File\+Seek.\+c
\item I\+File\+Set\+E\+O\+F.\+c
\item I\+File\+Set\+Writeability.\+c
\item I\+File\+Set\+Write.\+c
\item I\+File\+Size.\+c
\item I\+File\+Tell.\+c
\item I\+File\+Truncate.\+c
\item I\+File\+Write\+Access.\+c
\item I\+File\+Write.\+c
\item I\+File\+Write\+Status.\+c
\item I\+File\+Write\+Status\+Message.\+c
\end{DoxyItemize}

Some of these are named based on the standard C library functions that they emulate. Others are implementation-\/specific functions.

The overall idea of a I\+File is that of a H\+D\+F5 dataset. This dataset is 1-\/dimensional, with a datatype of unsigned-\/8-\/bit. It is infinitely extendable. It has three string attributes\+:


\begin{DoxyItemize}
\item writeable\+: \char`\"{}\+T\+R\+U\+E\char`\"{} or \char`\"{}\+F\+A\+L\+S\+E\char`\"{}. The user can set this so that don't accidentally over-\/write it or delete it. All I\+Files are created with writeable=\char`\"{}\+T\+R\+U\+E\char`\"{}
\item access\+: an integer betwen 0 and 6, converted to a string. Corresponds to one of the following \#define'd parameters\+: \begin{DoxyItemize}
\item I\+F\+I\+L\+E\+\_\+\+C\+L\+O\+S\+E\+D 0 \item I\+F\+I\+L\+E\+\_\+\+R 1 \item I\+F\+I\+L\+E\+\_\+\+W 2 \item I\+F\+I\+L\+E\+\_\+\+A 3 \item I\+F\+I\+L\+E\+\_\+\+R\+P 4 \item I\+F\+I\+L\+E\+\_\+\+W\+P 5 \item I\+F\+I\+L\+E\+\_\+\+A\+P 6\end{DoxyItemize}
These are named based on the access string used during the \hyperlink{IFileOpen_8c_a659760c048381d534347487e14cd5e25}{I\+File\+Open()} function-\/call, the \char`\"{}\+P\char`\"{} meaning \char`\"{}+\char`\"{}. This keeps track of how the file was opened so only appropriate operations are allowed. Note that a file that is open cannot be opened by another command\+: the file must be C\+L\+O\+S\+E\+D in order to be opened. This implements a very simple locking mechanism
\item dataset\+\_\+type\+: for an I\+File this must be \char`\"{}1\char`\"{}, which corresponds to the C \#define G\+S\+\_\+\+D\+A\+T\+A\+S\+E\+T\+\_\+\+T\+Y\+P\+E\+\_\+\+I\+N\+T\+E\+R\+N\+A\+L\+\_\+\+F\+I\+L\+E This is needed because image rasters are stored as datasets as well, and we need to distinguish between these.
\end{DoxyItemize}

The returned data structure is defined as\+: 
\begin{DoxyCode}
\textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{
  hid\_t ifile\_id;
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} file\_position;
  \textcolor{keywordtype}{int} readPastEOF;
  \textcolor{keywordtype}{int} last\_operation\_status;
  \textcolor{keywordtype}{char} last\_operation\_status\_message[512];
  \textcolor{keywordtype}{int} access;
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} size;
\} \hyperlink{structIFILE}{IFILE};
\end{DoxyCode}



\end{DoxyParagraph}
\begin{DoxyParagraph}{}
The parameters in this structure are defined as follows\+:
\end{DoxyParagraph}

\begin{DoxyItemize}
\item {\itshape ifile\+\_\+id}\+: the H\+D\+F5 object-\/id for this dataset.
\item {\itshape file\+\_\+position}\+: This is the next byte to read-\/from or write-\/to, where file\+\_\+position=0 means to read/write the first byte in the file.
\item {\itshape read\+Past\+E\+O\+F}\+: \char`\"{}\+T\+R\+U\+E\char`\"{}=1 or \char`\"{}\+F\+A\+L\+S\+E\char`\"{}=0. Whether the previous operation tried to read past the last byte in the file.
\item {\itshape last\+\_\+operation\+\_\+status}\+: \char`\"{}\+S\+U\+C\+C\+E\+S\+S\char`\"{}=1 or \char`\"{}\+F\+A\+I\+L\+U\+R\+E\char`\"{}=0 Each operation on the I\+File sets this.
\item {\itshape last\+\_\+operation\+\_\+status\+\_\+message}\+: a string written by each of the I\+File functions, whether they succeed or fail.
\item {\itshape access}\+: A copy of the dataset-\/metadata entry.
\item {\itshape size}\+: The current file size in bytes. This is obtained when opened using H\+D\+F5 function calls. Thereafter it is updated by the the functions as needed.
\end{DoxyItemize}

\begin{DoxyParagraph}{}
Functions that deal with these metadata items are given below. Generally the user should never call any of these, except for\+:
\begin{DoxyItemize}
\item I\+File\+Set\+Writeability() for setting the writeability of an I\+File when it is closed.
\item I\+File\+Error() for determining error status
\item I\+File\+Perror() for printing the latest error
\item I\+File\+E\+O\+F() for determining the E\+O\+F status of last read
\item I\+File\+Seek() for moving the file position
\item I\+File\+Tell() for determining the file position
\item I\+File\+Rewind() for setting the file position to 0
\end{DoxyItemize}
\end{DoxyParagraph}

\begin{DoxyItemize}
\item G\+S\+\_\+\+Object\+Is\+I\+File -- must be a dataset with dataset\+\_\+type=\char`\"{}1\char`\"{}
\item G\+S\+\_\+\+Dataset\+Get\+Type-- returns the dataset\+\_\+type
\item G\+S\+\_\+\+Dataset\+Set\+Type-- sets the dataset\+\_\+type
\item I\+File\+Clear\+Error -- sets last\+\_\+operation\+\_\+status=\char`\"{}\+S\+U\+C\+C\+E\+S\+S\char`\"{} and sets last\+\_\+operation\+\_\+status\+\_\+message
\item I\+File\+Error -- returns T\+R\+U\+E if last\+\_\+operation\+\_\+status=\char`\"{}\+F\+A\+I\+L\+U\+R\+E\char`\"{}
\item I\+File\+Perror -- prints last\+\_\+operation\+\_\+status\+\_\+message
\item I\+File\+Read\+Status -- reads last\+\_\+operation\+\_\+status, and last\+\_\+operation\+\_\+status\+\_\+message
\item I\+File\+Write\+Status -- writes last\+\_\+operation\+\_\+status, and last\+\_\+operation\+\_\+status\+\_\+message
\item I\+File\+Write\+Status\+Message -- writes last\+\_\+operation\+\_\+status\+\_\+message
\item I\+File\+E\+O\+F -- returns T\+R\+U\+E if read\+Past\+E\+O\+F=\char`\"{}\+T\+R\+U\+E\char`\"{}
\item I\+File\+Set\+E\+O\+F -- writes to read\+Past\+E\+O\+F
\item I\+File\+Get\+Write -- returns T\+R\+U\+E If writeable=\char`\"{}\+T\+R\+U\+E\char`\"{}
\item I\+File\+Set\+Write -- sets writeability (developer function)
\item I\+File\+Set\+Writeability -- sets writeability (user function)
\item I\+File\+Read\+Access -- reads access
\item I\+File\+Write\+Access -- writes access
\item I\+File\+Seek -- sets file\+\_\+position
\item I\+File\+Tell -- reads file\+\_\+position
\item I\+File\+Rewind -- sets file\+\_\+position to \char`\"{}0\char`\"{}
\end{DoxyItemize}

\begin{DoxyParagraph}{}
Functions to deal with the file size directly\+:
\end{DoxyParagraph}

\begin{DoxyItemize}
\item I\+File\+Truncate -- sets size of file (can shrink or grow)
\item I\+File\+Allocate -- expands file size if needed
\item I\+File\+Size -- gets the current file size from the struct
\item I\+File\+Size\+H\+D\+F -- gets the current file size from H\+D\+F
\end{DoxyItemize}

\begin{DoxyParagraph}{}
Other functions that the user can use include\+:
\end{DoxyParagraph}

\begin{DoxyItemize}
\item I\+File\+Open -- open an I\+File
\item I\+File\+Close -- close an I\+File
\item I\+File\+Flush -- flush any changes to the I\+File to disk
\item I\+File\+Getc -- read a single character
\item I\+File\+Gets -- read a newline-\/terminated string
\item I\+File\+Read -- read a set number of bytes
\item I\+File\+Scanf -- formatted-\/read from next \char`\"{}line\char`\"{}
\item I\+File\+Putc -- write a single character
\item I\+File\+Puts -- write a newline-\/terminated string
\item I\+File\+Write -- write a set number of bytes
\item I\+File\+Printf -- write a formatted string
\end{DoxyItemize}

\begin{DoxyParagraph}{}
Note that there is only O\+N\+E C\+O\+P\+Y of the file state, so there can only be one process that is using it at one time. This is on purpose so that there are no parallel-\/read-\/write issues. 
\end{DoxyParagraph}
